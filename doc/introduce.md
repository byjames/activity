## 游戏流程

1. 房主开启房间，等待用户进入
    1.1 房主未开启房间，普通用户进入, 提示房间不存在
    
2. 用户进入房间
> 用户进入房间更新房间的在线人数

    2.1 游戏等待中
        2.1.1 房间麦位用户进入游戏组，等待游戏开始
        2.1.2 无麦位用户进入观看席，等待游戏开始
        
    2.2 游戏进行中
        2.2.1 用户进入观看席，观看游戏过程
        
    2.3 游戏结束，告知游戏排行榜
        
    
3. 房主开始游戏

> 只有房主有权发起游戏

4. 房主重新开始游戏

> 只有房主有权重新开始游戏

5. 游戏过程

> 从房主开始依次，轮流游戏，游戏失败者，游戏栏头像自动消失，观看用户获得提示，xx失败了。失败者可以继续观看游戏进程

    5.1 用户正常操作
        5.1.1 跳成功，更新分数，服务广播下一个用户
        5.1.2 跳失败，告知失败，服务广播下一个用户，告知失败者
    
    5.2 用户不进行任何操作
        5.2.1 倒计时结束后，广播下一个用户，告知用户失败
        
    5.3 用户强制关闭游戏，退出房间
    > 用户退出房间更新房间的在线人数
    
        5.1 房主退出房间，关闭房间，清空房间(无论游戏是否进行中)
        5.2 非房主用户退出房间
            5.2.1 观察组用户退出，直接删除用户及相关信息
            5.2.2 游戏组用户退出，直接删除用户及相关信息，并广播更新房间用户列表

6. 游戏结束
> 弹出游戏排行榜界面，排行榜按照用户的分数倒序排列，显示用户在第几轮失败了

    7.1 房主用户可以重新发起游戏，房间信息及房间用户信息重置（状态，分数，回合数，更新时间）
    
    
    
    
    
    
### 模块
    rooms   房间  房间状态有 等待、开始、结束
    
    users   用户  房间用户有:游戏房间用户(即麦位上可以玩游戏的),观看房间用户(即观看席的用户)    用户状态有：等待、开始、结束、观看
    
    application 游戏应用
    
    connect 用来绑定socket连接信息
    
    
### 逻辑
    
    socket连接初始化
        1. 用户
            如果用户不存在初始化，默认状态为(等待状态)
            用户存在，告知原有用户连接，在别处登录已被顶出,后重新初始化用户信息
        2. 房间
            房间不存在
                普通用户进入提示房间不存在
                房主进入，初始化房间信息，默认状态为等待
            房间已经存在
                加入房间
                    麦位用户加入游戏组
                    普通用户加入观看组
            
                根据房间现有状态进行推送
                    等待中
                        推送，所有等待用户
                    开始中
                        推送游戏场景
                        如果进行中的游戏用户不是start状态，推送[]
                    游戏结束
                        推送游戏结果页
                        
    上下麦位
        首先游戏等待中才可以上下麦位
        
        房主踢人后，被踢用户1分钟内不可再次上麦
                        
                        
    游戏过程
        游戏等待中
        
        房主发起游戏开始
            游戏中用户退出，重新进入
        
        游戏结束
            游戏结束后，判断当前房间中，是否包含房主，
                如果有房主，广播游戏结束
                没有房主，关闭房间
                
            没有房主，提示房主已离开关闭房间
            
            
            
            
            
    延迟检查
        房间时间更新了 不做任何处理
        
        房间时间没有更新
            如果用户不在了
                直接下一个
        
            如果用户状态为start且未更新时间 下一个用户
            如果用户状态非start，下一个用户
        
    socket断开连接
        判断退出当前用户的连接和当前连接的fd是否一致，如果一致，处理
            
            房主离开，且房间没有开始
                关闭房间
            
            如果当前房间在游戏中,且用户也在游戏中
                用户游戏结束
                
            如果当前房间为等待状态且用户为麦位用户，广播更新房间用户
            
        不一致、说明用户又重新连上了，不做处理